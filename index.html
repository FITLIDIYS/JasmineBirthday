<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Beating Heart Dots</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: black;
            overflow: hidden;
            position: relative;
        }

        .dot {
            position: absolute;
            width: 6px;
            height: 6px;
            background-color: red;
            border-radius: 50%;
            transition: left 2s ease-in-out, top 2s ease-in-out;
            will-change: transform;
        }

        @keyframes beat {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.3);
            }
        }

        @keyframes moveInside {
            0% {
                transform: translate(0, 0);
            }
            50% {
                transform: translate(var(--dx), var(--dy));
            }
            100% {
                transform: translate(0, 0);
            }
        }

        .beating {
            animation: beat 1.5s infinite ease-in-out alternate;
        }

        .moving {
            animation: moveInside 3s infinite ease-in-out alternate;
        }
    </style>
</head>
<body>
    <!-- Audio untuk autoplay -->
    <audio id="bg-music" src="catHappy.mp3" loop></audio>

    <canvas id="textCanvas" width="500" height="200" style="display:none;"></canvas>

    <script>
        const dots = [];
        let density = window.innerWidth < 1000 ? 800 : 1200;
        const body = document.body;
        let clickCount = 0;
        const audio = document.getElementById("bg-music");

        function playMusic() {
            // Memulai lagu hanya jika belum dimainkan
            if (audio.paused) {
                audio.play().catch(error => console.log("Autoplay blocked:", error));
            }
        }

        function generateDots() {
            for (let i = 0; i < density; i++) {
                let dot = document.createElement('div');
                dot.classList.add('dot');

                let x = Math.random() * window.innerWidth;
                let y = Math.random() * window.innerHeight;

                dot.style.left = `${x}px`;
                dot.style.top = `${y}px`;

                body.appendChild(dot);
                dots.push(dot);
            }
        }

        function createHeartShape() {
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2 - 50;
            const scaleFactor = window.innerWidth < 600 ? 10 : 18;

            let usedPositions = new Set();

            dots.forEach((dot, i) => {
                let x, y, posX, posY;
                let maxAttempts = 10, attempt = 0;

                do {
                    let t = Math.random() * Math.PI * 2;
                    let r = Math.sqrt(Math.random()) * 16;

                    x = 16 * Math.pow(Math.sin(t), 3) * (r / 16);
                    y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)) * (r / 16);

                    posX = Math.round(centerX + x * scaleFactor);
                    posY = Math.round(centerY + y * scaleFactor);

                    attempt++;
                } while (attempt < maxAttempts);

                usedPositions.add([posX, posY]);

                setTimeout(() => {
                    dot.style.left = `${posX}px`;
                    dot.style.top = `${posY}px`;
                }, Math.random() * 500);

                if (Math.random() < 0.3) {
                    dot.classList.add("beating");
                }

                if (Math.random() < 0.5) {
                    let dx = (Math.random() - 0.5) * 8;
                    let dy = (Math.random() - 0.5) * 8;
                    dot.style.setProperty('--dx', `${dx}px`);
                    dot.style.setProperty('--dy', `${dy}px`);
                    dot.classList.add("moving");
                }
            });
        }

        function createTextShape() {
            const canvas = document.getElementById('textCanvas');
            const ctx = canvas.getContext('2d');

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = "bold 80px Arial";
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            ctx.fillText("HAPPY", canvas.width / 2, canvas.height / 2.8);
            ctx.fillText("BIRTHDAY", canvas.width / 2, canvas.height / 2.2);
            ctx.fillText("JASMINE", canvas.width / 2, canvas.height / 1.8);
            ctx.fillText("CANTIK", canvas.width / 2, canvas.height / 1.5);

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
            const positions = [];
            const gap = 8;

            for (let y = 0; y < canvas.height; y += gap) {
                for (let x = 0; x < canvas.width; x += gap) {
                    let index = (y * canvas.width + x) * 4;
                    if (imageData[index] > 100) {
                        positions.push([x, y]);
                    }
                }
            }

            let usedDots = Math.min(positions.length, dots.length);

            for (let i = 0; i < usedDots; i++) {
                let pos = positions[i];
                let dot = dots[i];
                if (pos) {
                    setTimeout(() => {
                        dot.style.left = `${pos[0]}px`;
                        dot.style.top = `${pos[1]}px`;
                    }, Math.random() * 500);
                }
            }

            for (let i = usedDots; i < dots.length; i++) {
                let dot = dots[i];
                dot.style.backgroundColor = "whitesmoke";
                dot.style.transition = "background-color 0.5s ease-in-out";
            }
        }

        generateDots();

        document.addEventListener('click', () => {
            playMusic();
            clickCount++;
            if (clickCount === 1) {
                createTextShape();
            } else if (clickCount === 2) {
                createHeartShape();
                clickCount = 1;
            }
        });

        window.addEventListener('resize', () => {
            document.body.innerHTML = '';
            dots.length = 0;
            density = window.innerWidth < 600 ? 500 : 1200;
            generateDots();
        });

        // Coba autoplay saat halaman dimuat (beberapa browser memblokir ini)
        window.addEventListener("load", playMusic);
    </script>
</body>
</html>
